generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id          Int @id @default(autoincrement())
  fullname    String
  username    String  @unique
  password    String
  users       User[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model User {
  id          Int       @id @default(autoincrement())
  ownerId     Int
  fullname    String
  username    String    @unique
  password    String
  products    Product[]
  contracts   Contract[]
  owner       Admin    @relation(fields: [ownerId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model ProductCategory {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id             Int        @id @default(autoincrement())
  name           String
  description    String?
  purchasePrice  Float      // sotib olingan narx
  rentalPrice    Float      // arendaga beriladigan narx
  yearPercent    Float      // yillik necha foizdan beriladi?
  ownerId        Int
  categoryId     Int
  brand          String?
  model          String?
  owner          User       @relation(fields: [ownerId], references: [id])
  category       ProductCategory @relation(fields: [categoryId], references: [id])
  contracts      Contract[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model Customer {
  id          Int        @id @default(autoincrement())
  fullName    String
  phone       String
  passportImg String?    // pasport rasmi (url yoki fayl path)
  contracts   Contract[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Contract {
  id             Int               @id @default(autoincrement())
  productId      Int
  customerId     Int
  ownerId        Int

  startDate      DateTime
  endDate        DateTime?

  agreedPrice    Float      // mijoz bilan kelishilgan narx
  yearPercent    Float      // yillik necha foizdan berilgan
  initialPayment Float      // boshlang‘ich to‘lov
  totalPrice     Float      // umumiy kelishilgan summa

  contractImg    String?

  product        Product           @relation(fields: [productId], references: [id])
  customer       Customer          @relation(fields: [customerId], references: [id])
  owner          User              @relation(fields: [ownerId], references: [id])
  payments       Payment[]
  schedules      ContractSchedule[]

  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
}

model ContractSchedule {
  id          Int       @id @default(autoincrement())
  contractId  Int
  monthNumber Int       // qaysi oy (1,2,3,...)
  amount      Float     // shu oy uchun summa
  dueDate     DateTime  // to‘lov muddati (majburiy bo‘lsa)

  contract    Contract  @relation(fields: [contractId], references: [id])
}



model Payment {
  id          Int        @id @default(autoincrement())
  contractId  Int
  amount      Float      // qancha pul to‘lashi kerak
  dueDate     DateTime   // qachon to‘lashi kerak
  paid        Boolean    @default(false)
  paidAt      DateTime?
  contract    Contract   @relation(fields: [contractId], references: [id])
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}